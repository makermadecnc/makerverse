#!/bin/bash
. "$(dirname "$0")/_/husky.sh"

branch="$(git rev-parse --abbrev-ref HEAD)"

if [ "$branch" = "master" ]; then
  echo "[ERR] commits directly to master are not allowed."
  exit 1
fi

yarn run lint-staged

# Check if this project is embedded within MakerHub. If so, ensure that it's using the right production config.
PKG="../../../package.json"
if grep -q "\"productName\": \"MakerHub\"" "$PKG"; then
  pushd "../../../"
  maker-env sync Makerverse
  popd
else
  echo "$PKG was not MakerHub root; skipping sync."
fi

# Make sure to use public registries before committing.
maker-env prep --npm https://registry.yarnpkg.com
